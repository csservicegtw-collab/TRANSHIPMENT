<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Stuffing List ‚Äì Eksternal</title>
  <link rel="stylesheet" href="../assets/css/base.css">
  <link rel="stylesheet" href="../assets/css/theme-coload.css">
</head>
<body>
  <div class="container">
    <h1>Stuffing List ‚Äì Eksternal</h1>
    <p style="color:gray;">(Read-only mode ‚Äì hanya menampilkan data)</p>

    <!-- üîç Pencarian -->
    <div class="search-container">
      <div class="search-wrapper">
        <select id="filterSelect" class="search-filter">
          <option value="all">Semua</option>
          <option value="vessel">Vessel</option>
          <option value="voyage">Voyage</option>
          <option value="type">Tipe</option>
        </select>
        <input type="text" id="searchInput" class="search-input" placeholder="Cari data...">
      </div>
    </div>

    <!-- üîΩ Filter Tipe -->
    <select id="filterDropdown" class="dropdown" onchange="renderTable()">
      <option value="all">Tampilkan Semua</option>
      <option value="Feeder">Feeder</option>
      <option value="Mother">Mother</option>
    </select>

    <!-- üìã Tabel Data -->
    <table id="vesselTable">
      <thead>
        <tr>
          <th>Vessel</th>
          <th>Voyage</th>
          <th>Tipe</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="history.back()">‚¨ÖÔ∏è Kembali</button>
  </div>

  <!-- üî• FIREBASE SCRIPT -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    // === KONFIGURASI FIREBASE ===
    const firebaseConfig = {
      apiKey: "AIzaSyAu0br1o29T7QM7StyHezHlZ67WiVsTzx0",
      authDomain: "transshipment-8c2da.firebaseapp.com",
      projectId: "transshipment-8c2da",
      storageBucket: "transshipment-8c2da.firebasestorage.app",
      messagingSenderId: "997549413633",
      appId: "1:997549413633:web:b173bddaf4b73cccd13700",
      measurementId: "G-21L0CZJ1MC"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tableBody = document.querySelector("#vesselTable tbody");
    const searchInput = document.getElementById("searchInput");
    const filterSelect = document.getElementById("filterSelect");
    const filterDropdown = document.getElementById("filterDropdown");

    let vesselData = [];

    // === 1Ô∏è‚É£ Ambil Data dari Firestore ===
    async function loadData() {
      tableBody.innerHTML = "<tr><td colspan='3'>üîÑ Memuat data...</td></tr>";
      vesselData = [];
      const vesselsRef = collection(db, "stuffing", "coload", "vessels");
      const snapshot = await getDocs(vesselsRef);
      snapshot.forEach(doc => {
        const d = doc.data();
        vesselData.push({
          vessel: d.vessel || "-",
          voyage: d.voyage || "-",
          type: d.type || "-"
        });
      });
      renderTable();
    }

    // === 2Ô∏è‚É£ Render Data ke Tabel ===
    function renderTable() {
      const keyword = searchInput.value.toLowerCase();
      const filterType = filterSelect.value;
      const dropdownFilter = filterDropdown.value;
      tableBody.innerHTML = "";

      const filtered = vesselData.filter(v => {
        const matchesKeyword =
          filterType === "all"
            ? Object.values(v).some(val => val.toLowerCase().includes(keyword))
            : v[filterType]?.toLowerCase().includes(keyword);

        const matchesDropdown =
          dropdownFilter === "all" || v.type.toLowerCase() === dropdownFilter.toLowerCase();

        return matchesKeyword && matchesDropdown;
      });

      if (filtered.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='3'>‚ùå Tidak ada data ditemukan.</td></tr>";
        return;
      }

      filtered.forEach(v => {
        const row = `
          <tr>
            <td>${v.vessel}</td>
            <td>${v.voyage}</td>
            <td>${v.type}</td>
          </tr>`;
        tableBody.insertAdjacentHTML("beforeend", row);
      });
    }

    // === 3Ô∏è‚É£ Event listener ===
    searchInput.addEventListener("input", renderTable);
    filterSelect.addEventListener("change", renderTable);

    // === 4Ô∏è‚É£ Jalankan pertama kali ===
    loadData();
  </script>
</body>
</html>
